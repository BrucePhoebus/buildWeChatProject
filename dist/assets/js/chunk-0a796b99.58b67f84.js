(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0a796b99"],{"685a":function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});n("4917");var o=function(){var e=window.navigator.userAgent;return/micromessenger/i.test(e)},s=function(){return!!window.navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}},"6e0e":function(e,t,n){"use strict";n.r(t);n("7f7f");var o=n("b970"),s=n("dc2b"),c=n("685a"),i=n("a78e"),a=n.n(i),r={components:{"head-nav-bar":s.a},data:function(){return{showPopup:!1,name:"",cerNumber:"",showCerNumber:"",phoneNumber:"",sendSmsNumber:"",showPhoneNumber:"",sex:"男",columns:["男","女"],alterBtn:"修改信息",isAlter:"disabled",allowEdit:"disabled",modifiedClass:{},isChanged:!1,showSmsCheck:!1,smsCode:"",smsCodeBtnValue:"获取验证码",countdownSize:60,curCount:0}},methods:{alterInfo:function(){"disabled"===this.isAlter?this.openSaveActive():this.closeSaveActive()},openSaveActive:function(){this.showPhoneNumber=this.phoneNumber,this.isAlter=!1,this.alterBtn="保存",this.showSmsCheck=!this.showSmsCheck},closeSaveActive:function(){this.checkPhoneInfo(this.showPhoneNumber)&&this.saveInfo()&&(this.phoneNumber=this.showPhoneNumber,this.alterShowInfo(this.phoneNumber,this.cerNumber),this.isAlter="disabled",this.alterBtn="修改信息",this.showSmsCheck=!this.showSmsCheck)},saveInfo:function(){var e=this,t=Object(c.b)()?a.a.get("openid"):"",n={headers:{"Content-Type":"multipart/form-data"}};if("disabled"===e.allowEdit){if(e.phoneNumber===e.showPhoneNumber)return!0;if(""===e.sendSmsNumber)return Object(o.j)("请获取验证码！"),!1;if(""===e.smsCode)return Object(o.j)("验证码不能为空！"),!1;var s={openId:t,phoneNumber:e.showPhoneNumber,code:e.smsCode};this.$post(ctx2+"/pubWeb/system/public/savePhoneNumberByOpenId",s,n).then(function(t){if(!t)return Object(o.j)("验证码无效！"),!1;Object(o.j)("保存成功！"),e.isChanged=!0}).catch(function(e){return console.log(e),!1})}else{var i={wxOpenId:t,fullName:e.name,idNumber:e.cerNumber,sex:e.sex};e.$post(ctx2+"/pubWeb/public/faceRecognition/saveAuthenticatedUserInfo",i,n).then(function(t){if(!t)return Object(o.j)("服务器异常！"),!1;e.$store.commit("CARD_CODE",{cardCode:e.cerNumber}),e.$store.commit("CARD_NAME",{cardName:e.name}),Object(o.j)("保存成功！")}).catch(function(e){return console.log(e),!1})}return!0},unboundInfo:function(){var e=this;o.e.confirm({title:"警告",message:"删除信息绑定后将无法查看个人信息！"}).then(function(){var t={openId:Object(c.b)()?a.a.get("openid"):""};e.$post(ctx2+"/pubWeb/public/faceRecognition/deleteAuthenticatedUserInfo",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){t?(Object(o.j)("解除绑定成功！"),e.$store.commit("SET_FACE_CHECK",!1),setTimeout(function(){o.e.confirm({title:"提示",message:"是否关闭当前页面?"}).then(function(){wx.closeWindow()}).catch(function(){e.$router.push({path:"/personalCheck"})})},1500)):Object(o.j)("服务器异常！")}).catch(function(e){console.log(e)})}).catch(function(){})},getSmsCode:function(){var e=this;if(this.checkPhoneInfo(e.showPhoneNumber)){this.$fetch(ctx2+"/pubWeb/system/public/smsCode?number="+e.phoneNumber).then(function(t){e.sendSmsNumber=e.phoneNumber}).catch(function(e){console.log(e)}),e.curCount=e.countdownSize,e.smsCodeBtnValue="倒计时 "+e.curCount+"S";var t=setInterval(function(){e.curCount>0?(e.curCount--,e.smsCodeBtnValue="倒计时 "+e.curCount+"S"):(clearInterval(t),e.smsCodeBtnValue="获取验证码")},1e3)}},checkPhoneInfo:function(e){return""===e?(Object(o.j)("请输入手机号码！"),!1):!!/^1[3|4|5|7|8]\d{9}$/.test(e)||(Object(o.j)("手机号码格式不正确！"),!1)},alterShowInfo:function(e,t){this.showPhoneNumber=e.substr(0,3)+"****"+e.substr(e.length-4,4),this.showCerNumber=t.substr(0,4)+"***********"+t.substr(t.length-3,3)},selectSex:function(){"disabled"!==this.allowEdit&&(this.showPopup=!this.showPopup)},confirmSex:function(e,t){this.sex=e,this.showPopup=!1},confirmPicker:function(e,t){this.sex=e,this.showPopup=!this.show}},mounted:function(){var e=this,t=Object(c.b)()?a.a.get("openid"):"";e.$fetch(ctx2+"/pubWeb/public/faceRecognition/getAuthenticatedUserInfo?openId="+t).then(function(t){t&&(e.phoneNumber=t.phone,e.name=t.name,e.sex=t.sex,e.cerNumber=t.id,e.alterShowInfo(e.phoneNumber,e.cerNumber))}).catch(function(e){console.log(e)})}},u=(n("893d"),n("0c7c")),l=Object(u.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"personal-setting"},[n("head-nav-bar",{attrs:{title:"个人信息设置"}}),n("div",{staticClass:"personal-info-content"},[n("van-cell-group",[n("van-field",{attrs:{id:"phoneNumber",label:"手机号码",placeholder:"请输入手机号码",type:"text",error:e.isChanged,disabled:e.isAlter,clearable:""},model:{value:e.showPhoneNumber,callback:function(t){e.showPhoneNumber="string"==typeof t?t.trim():t},expression:"showPhoneNumber"}}),n("van-field",{directives:[{name:"show",rawName:"v-show",value:e.showSmsCheck,expression:"showSmsCheck"}],attrs:{clearable:"",label:"短信验证码",type:"number",placeholder:"请输入验证码"},model:{value:e.smsCode,callback:function(t){e.smsCode=t},expression:"smsCode"}},[n("van-button",{staticClass:"blue-color",attrs:{slot:"button",size:"small",type:"default",disabled:0!=e.curCount},on:{click:e.getSmsCode},slot:"button"},[e._v(e._s(e.smsCodeBtnValue)+"\n\t\t\t\t")])],1),n("van-field",{attrs:{id:"name",label:"姓名",placeholder:"请输入姓名",type:"text",disabled:e.allowEdit,"label-align":"left",clearable:""},model:{value:e.name,callback:function(t){e.name="string"==typeof t?t.trim():t},expression:"name"}}),n("van-cell",{attrs:{id:"sex",title:"性别",value:e.sex,"data-type":"list","value-class":"change-cell","is-link":""},on:{click:e.selectSex}}),n("van-field",{attrs:{id:"cerNumber",label:"证件号码",placeholder:"请输入身份证号码",type:"text",disabled:e.allowEdit,clearable:""},model:{value:e.showCerNumber,callback:function(t){e.showCerNumber="string"==typeof t?t.trim():t},expression:"showCerNumber"}})],1)],1),n("div",{staticClass:"personal-set-btn"},[n("van-button",{staticClass:"blueButton new-btn",attrs:{size:"large"},on:{click:e.alterInfo}},[e._v(e._s(e.alterBtn))]),n("van-button",{staticClass:"blueButton new-btn red-btn",attrs:{size:"large"},on:{click:e.unboundInfo}},[e._v("解除个人信息绑定")])],1),n("van-popup",{attrs:{position:"bottom",overlay:!1},model:{value:e.showPopup,callback:function(t){e.showPopup=t},expression:"showPopup"}},[n("van-picker",{attrs:{"show-toolbar":"",columns:e.columns},on:{confirm:e.confirmSex,cancel:e.selectSex}})],1)],1)},[],!1,null,"0cf4cbf4",null);t.default=l.exports},"893d":function(e,t,n){"use strict";var o=n("9dc3");n.n(o).a},"9dc3":function(e,t,n){},dc2b:function(e,t,n){"use strict";var o={props:{title:{type:String,default:""}},data:function(){return{}},methods:{goBack:function(){this.$router.back()}},mounted:function(){}},s=n("0c7c"),c=Object(s.a)(o,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"head-nav-bar"},[t("van-nav-bar",{attrs:{title:this.title,"left-text":"返回","left-arrow":""},on:{"click-left":this.goBack}})],1)},[],!1,null,"3ba45948",null);t.a=c.exports}}]);